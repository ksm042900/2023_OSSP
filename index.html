<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <!-- https://developer.mozilla.org/en-US/docs/Web/HTTP/CSP -->
    <meta http-equiv="Content-Security-Policy-Report-Only" content="default-src 'self'; script-src 'self'; style-src 'self'">
    <link href="./styles.css" rel="stylesheet">
    <!-- <link rel="stylesheet" type="text/css" href="//fonts.googleapis.com/css?family=Open+Sans" /> -->
    <script src="https://www.gstatic.com/firebasejs/7.2/firebase.js"></script>
  
    <title>Chosun University Typing Practice Pcrogram</title>
  </head>
  <body>
    <div class="login-form">
      <form>
        <a href="../index.html" id="logo_text" style="color:rgb(255, 255, 255);"> <img class="logo" src="../img/bigLogo.png" alt="">TypingRPG</a>
        <input type="email" id="signInEmail" placeholder="Email">
        <input type="password" id="signInPassword" placeholder="Password">
        <input type="submit" value="Login" id="signInButton">
      </form>
   
      <div class="links">
        <a href="./signUpForm.html" target='_blank'>Don't have an account? Sign up here</a>
      </div>



      <label id="or_label">OR</label>
      <div class="googleLogin_form"></div>

    <button id="googleLoginButton">
      <div class="google-icon-wrapper">
          <img class="google-icon" src="https://upload.wikimedia.org/wikipedia/commons/5/53/Google_%22G%22_Logo.svg"/>
        </div>
        <p class="btn-text"><b>Sign in with google</b></p>
      </div>

    </button>
<div>

  <!-- <form>
      <h1>회원가입</h1>
      <div>Name : <input type="name" id="signUpName"> </div>
      <div>Email : <input type="email" id="signUpEmail"> </div>
      <div>password : <input type="password" id="signUpPassword"> </div>
      <button type="submit" id="signUpButton">회원가입 확인</button>
      <button>로그인</button>
  </form>

   -->

  <!-- 타이핑효과 불러오기 -->

 

    <section>     
    </section>
    <footer>    
      <!-- @Mechanical Keyboard Gallery -->
    </footer>
  </div>


 <script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/9.15.0/firebase-app.js";
import { getAnalytics } from "https://www.gstatic.com/firebasejs/9.15.0/firebase-analytics.js";

//import { } from "https://www.gstatic.com/firebasejs/7.2/firebase.js";
// TODO: Add SDKs for Firebase products that you want to use
// https://firebase.google.com/docs/web/setup#available-libraries

// Your web app's Firebase configuration
// For Firebase JS SDK v7.20.0 and later, measurementId is optional
const firebaseConfig = {
  apiKey: "AIzaSyAhw6yriMRJ32RdkIYsYHYt-9-b_pWzZak",
  authDomain: "typingrpg.firebaseapp.com",
  databaseURL: "https://typingrpg-default-rtdb.firebaseio.com",
  projectId: "typingrpg",
  storageBucket: "typingrpg.appspot.com",
  messagingSenderId: "208720513665",
  appId: "1:208720513665:web:c09ce2c4b9cd95b5535b80",
  measurementId: "G-NLG86SG4T6"

};

// Initialize Firebase
const app = initializeApp(firebaseConfig);
const analytics = getAnalytics(app);

//firebase.initializeApp(firebaseConfig);
// Initialize Cloud Firestore and get a reference to the service



import { getAuth, setPersistence, createUserWithEmailAndPassword, signInWithEmailAndPassword ,signOut ,browserSessionPersistence,signInWithPopup, GoogleAuthProvider} from "https://www.gstatic.com/firebasejs/9.15.0/firebase-auth.js";

const auth = getAuth();
firebase.initializeApp(firebaseConfig);
//   auth.languageCode = 'it';
//   provider.setCustomParameters({
//   'login_hint': 'user@example.com'
//   });

const provider = new GoogleAuthProvider();// Google 공급자 개체의 인스턴스 생성
//google 로그인 팝업 호출


document.getElementById('googleLoginButton').addEventListener('click',()=>{
  console.log('google login');
  signInWithPopup(auth, provider)
  .then((result) => {
      // This gives you a Google Access Token. You can use it to access the Google API.
      const credential = GoogleAuthProvider.credentialFromResult(result);
      const token = credential.accessToken;
      // The signed-in user info.
      const user = result.user;
      const google_name = user.displayName;
      const google_email = user.email;
      console.log(user.displayName)
      console.log(user.email);
      console.log(auth.currentUser.displayName);

      newPage(); 
     console.log(result);
     
     
      // ...
  }).catch((error) => {
      // Handle Errors here.
      const errorCode = error.code;
      const errorMessage = error.message;
      // The email of the user's account used.
      const email = error.customData.email;
      // The AuthCredential type that was used.
      const credential = GoogleAuthProvider.credentialFromError(error);
     console.log(result);
      // ...
});
 
})




//   document.getElementById('signUpButton').addEventListener('click',(event)=>{
//       event.preventDefault() 
//       const signUpEmail = document.getElementById('signUpEmail').value
//       const signUpPassword = document.getElementById('signUpPassword').value
      

    
//       createUserWithEmailAndPassword(auth, signUpEmail, signUpPassword)
//           .then((userCredential) => {
//               // Signed in 
//               console.log("회원가입성공");
//               console.log(userCredential)
//               const user = userCredential.user;
//               const db = firebase.firestore();
//               firebase.database().ref('users/'+user.uid).set({
//                     uid: user.uid,
//                     email: signUpEmail,
//                     name: "",
//                     spd: 0, 
//                 });

              
          
//           })
//           .catch((error) => {
//               console.log("error")
//               const errorCode = error.code;
//               const errorMessage = error.message;
//           });

//   })

document.getElementById('signInButton').addEventListener('click',(event)=>{

    event.preventDefault() 
    const signInEmail = document.getElementById('signInEmail').value
    const signInPassword = document.getElementById('signInPassword').value
  
    signInWithEmailAndPassword(auth, signInEmail, signInPassword)
            .then((userCredential) => {
              newPage();   
                // Signed in 
                const user = userCredential.user;
                console.log(userCredential)
                loginSuccess(user.signInEmail, user.signInPassword);
         
            })
            .catch((error) => {
          
                const errorCode = error.code;
                const errorMessage = error.message;
            });
            
})
 

//   //로그인확인버튼을 눌렀을때
//   document.getElementById('loginCheckButton').addEventListener('click',(event)=>{
//     if( document.getElementById('loginCheckButton').innerHTML == "로그아웃"){
//         signOut(auth).then(() => {
//         // Sign-out successful.
//         console.log("로그아웃 성공");
//         }).catch((error) => {
//         // An error happened.
//         });
//     }else{
//         window.location.href = 'login.html'
//     }
// })


//   //만약 로그인된 상태이면 아래 함수 호출
//   auth.onAuthStateChanged(function(user) {
//     if (user) {
//         document.getElementById('loginCheckButton').innerHTML = "로그아웃";
//     } else {
//         // No user is signed in.
//         document.getElementById('loginCheckButton').innerHTML = "로그인";
//     }
//     });



//세션에 유저 정보 저장
setPersistence(auth, browserSessionPersistence)
.then(() => {
    // Existing and future Auth states are now persisted in the current
    // session only. Closing the window would clear any existing state even
    // if a user forgets to sign out.
    // ...
    // New sign-in will be persisted with session persistence.
    return signInWithEmailAndPassword(auth, signInEmail, signInPassword);
})
.catch((error) => {
    // Handle Errors here.
    const errorCode = error.code;
    const errorMessage = error.message;
});


//로그인 시 이동하는 함수
function newPage()  {
window.location.href = 'typingPage.html'
}

const loginSuccess = (signInEmail, signInPassword) => {
 document.getElementById('loginCheck').innerHTML = "로그아웃";
 };



//만약 로그인된 상태이면 아래 함수 호출
// auth.onAuthStateChanged(function(user) {
// if (user) {
//     document.getElementById('loginCheck').innerHTML = "로그아웃";
// } else {
//     // No user is signed in.
//     document.getElementById('loginCheck').innerHTML = "로그인";
// }
// });

console.log(app)



 </script>

  </body>
</html>
